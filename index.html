<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ì—¬í–‰ í”Œë˜ë„ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
        @keyframes f{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.a-f{animation:f 0.5s ease-out}
        #map { height: 100%; width: 100%; border-radius: 0.5rem; background-color: #e5e7eb; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

<!-- 1. ë¡œê·¸ì¸ í™”ë©´ -->
<div id="auth-screen" class="min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-8 rounded-xl shadow-xl w-full max-w-md border border-gray-200">
        <h1 class="text-2xl font-bold text-teal-600 mb-2 text-center">âœˆï¸ ì—¬í–‰ í”Œë˜ë„ˆ</h1>
        <p class="text-gray-500 text-center mb-6 text-sm">ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ê¸° ìœ„í•´ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
        <div class="space-y-4">
            <!-- oninput ì´ë²¤íŠ¸ê°€ í™”ë©´ì„ ë‹¤ì‹œ ê·¸ë¦¬ì§€ ì•Šë„ë¡ ìˆ˜ì •ë¨ -->
            <input type="email" id="auth-email" placeholder="ì´ë©”ì¼" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none">
            <input type="password" id="auth-password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none" onkeypress="if(event.key === 'Enter') handleAuth('login')">
            <div class="flex gap-2 pt-2">
                <button onclick="handleAuth('login')" class="flex-1 bg-teal-600 text-white p-3 rounded-lg hover:bg-teal-700 font-bold transition">ë¡œê·¸ì¸</button>
                <button onclick="handleAuth('signup')" class="flex-1 bg-gray-100 text-teal-700 p-3 rounded-lg hover:bg-gray-200 font-bold transition">íšŒì›ê°€ì…</button>
            </div>
            <p id="auth-msg" class="text-center text-sm text-red-500 mt-2 min-h-[20px]"></p>
        </div>
    </div>
</div>

<!-- 2. ë©”ì¸ ì•± í™”ë©´ -->
<div id="app-screen" class="hidden min-h-screen pb-20">
    <header class="bg-teal-600 text-white p-4 shadow-md sticky top-0 z-20 flex justify-between items-center">
        <h1 class="text-lg font-bold flex items-center gap-2"><span id="icon-map-h"></span>ë‚˜ë§Œì˜ ì—¬í–‰ í”Œë˜ë„ˆ</h1>
        <div class="flex gap-2 items-center">
             <span id="user-display" class="text-xs bg-teal-700 px-2 py-1 rounded hidden sm:block"></span>
             <button onclick="handleLogout()" class="text-xs bg-red-500 hover:bg-red-600 px-3 py-1 rounded transition">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>
    
    <div class="max-w-4xl mx-auto p-4">
        <div class="flex gap-1 mb-6 bg-white p-2 rounded-lg shadow overflow-x-auto justify-between" id="tabs"></div>
        <div id="view-content"></div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
            <h3 class="font-bold mb-4 text-red-600">âš ï¸ ë°ì´í„° ì´ˆê¸°í™”</h3>
            <p class="text-sm text-gray-600 mb-6">ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.</p>
            <div class="flex justify-end gap-2">
                <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 rounded text-sm">ì·¨ì†Œ</button>
                <button onclick="resetData()" class="px-4 py-2 bg-red-600 text-white rounded text-sm">í™•ì¸</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ğŸš¨ [ì„¤ì •] ë³¸ì¸ì˜ í‚¤ë¡œ ë³€ê²½í•˜ì„¸ìš”
    const MAP_KEY = 'AIzaSyBwZ1hfLte8a0KcT9V2Tht3da_gi2tC4Rw'; 
    const FIREBASE_CONFIG = {
        apiKey: "AIzaSyD1PRo3wCE4qVfb2oecjCpz0zUS4LskG8U",
        authDomain: "heroic-bonbon-481116-b5.firebaseapp.com",
        projectId: "heroic-bonbon-481116-b5",
        storageBucket: "heroic-bonbon-481116-b5.firebasestorage.app",
        messagingSenderId: "369088279206",
        appId: "1:369088279206:web:197df9cc38895a2e7afa67",
        measurementId: "G-8CP3MWTD7R"
    };
</script>

<script async defer id="gmap-script"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// Icons
const I={Map:'<path d="M3 6l6-3 6 3 6-3v15l-6 3-6-3-6 3z"/><path d="M9 3v15"/><path d="M15 6v15"/>',Cal:'<rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4"/><path d="M8 2v4"/><path d="M3 10h18"/>',Check:'<polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>',Gift:'<rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v6"/><path d="M5 12v6"/><path d="M12 22H5"/><path d="M12 22h7"/>',Dol:'<line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>',Plus:'<path d="M12 5v14"/><path d="M5 12h14"/>',Trash:'<path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M15 2h-6l-1 4h8z"/>',Pin:'<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/>',Search:'<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>'};
const svg=(p,c='currentColor')=>`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="${c}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${p}</svg>`;

// State
window.st = { tab:'overview', d:null, dayIdx:0, map:false };
// ì…ë ¥ê°’ì€ ë Œë”ë§ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ ë³„ë„ ê´€ë¦¬ (ëŠê¹€ ë°©ì§€ í•µì‹¬)
window.inputs = { dest:'', sDate:'', eDate:'', pack:'', sItem:'', sTo:'', exCat:'ì‹ë¹„', exItem:'', exCost:'', exDate:'', evTime:'09:00', evTit:'', evPl:'', evLat:null, evLng:null };
const initD = { destination:'ì œì£¼ë„', startDate:'', endDate:'', packingList:[], schedule:[{id:1, day:1, date:'', events:[]}], souvenirs:[], expenses:[] };

let db, auth, uid, gMap, gMark;

// 1. Firebase Init
try {
    const app = initializeApp(FIREBASE_CONFIG);
    db = getFirestore(app);
    auth = getAuth(app);
    onAuthStateChanged(auth, user => {
        if(user) {
            uid = user.uid;
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app-screen').classList.remove('hidden');
            document.getElementById('user-display').innerText = user.email;
            loadDB();
            loadMap();
        } else {
            uid = null;
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('app-screen').classList.add('hidden');
        }
    });
} catch(e) { alert("Firebase ì„¤ì • ì˜¤ë¥˜"); }

// 2. Auth
window.handleAuth = async (type) => {
    const e = document.getElementById('auth-email').value;
    const p = document.getElementById('auth-password').value;
    const m = document.getElementById('auth-msg');
    if(!e || !p) return m.innerText = "ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";
    try {
        if(type==='signup') await createUserWithEmailAndPassword(auth, e, p);
        else await signInWithEmailAndPassword(auth, e, p);
    } catch(err) { m.innerText = "ë¡œê·¸ì¸/ê°€ì… ì‹¤íŒ¨: " + err.code; }
};
window.handleLogout = () => signOut(auth);

// 3. Database & Sync
function loadDB() {
    onSnapshot(doc(db, 'plans', uid), s => {
        st.d = s.exists() ? s.data() : initD;
        if(!s.exists()) saveDB(initD);
        
        // DBì—ì„œ ê°’ì„ ë¶ˆëŸ¬ì™€ ë¡œì»¬ ì…ë ¥ì°½ì— ë™ê¸°í™” (ìµœì´ˆ 1íšŒ í˜¹ì€ íƒ­ ì „í™˜ì‹œë§Œ í•„ìš”í•˜ì§€ë§Œ ì—¬ê¸°ì„  ê°„ë‹¨íˆ ì²˜ë¦¬)
        // ì£¼ì˜: ì…ë ¥ ì¤‘ì—ëŠ” ì´ ê°’ì´ ë®ì–´ì”Œì›Œì§€ì§€ ì•Šë„ë¡ render()ì—ì„œ value ì²˜ë¦¬ë¥¼ ì˜í•´ì•¼ í•¨.
        // ì—¬ê¸°ì„œëŠ” DB ì—…ë°ì´íŠ¸ê°€ ì˜¤ë©´ ì…ë ¥ì„ ë®ì–´ì“°ì§€ ì•Šë„ë¡, render í•¨ìˆ˜ê°€ inputs ê°’ì„ ìš°ì„ í•˜ë„ë¡ í•¨.
        if(!window.inputs.dest) window.inputs.dest = st.d.destination || '';
        if(!window.inputs.sDate) window.inputs.sDate = st.d.startDate || '';
        
        render();
        if(st.tab==='overview' && st.map) updateMap();
    });
}
async function saveDB(d) { if(uid) await setDoc(doc(db, 'plans', uid), JSON.parse(JSON.stringify(d))); }
window.resetData = () => { saveDB(initD); document.getElementById('modal').classList.add('hidden'); window.inputs={...window.inputs, dest:'ì œì£¼ë„'}; render(); };
window.closeModal = () => document.getElementById('modal').classList.add('hidden');
window.openModal = () => document.getElementById('modal').classList.remove('hidden');

// 4. Map
function loadMap() {
    if(st.map) return;
    const s = document.getElementById('gmap-script');
    s.src = `https://maps.googleapis.com/maps/api/js?key=${MAP_KEY}&libraries=places&callback=initMap`;
}
window.initMap = () => { st.map=true; if(st.tab==='overview') updateMap(); };
window.geoCode = (addr) => {
    if(!st.map || !addr || !window.google) return;
    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({'address':addr}, (res,s)=>{
        if(s==='OK' && gMap){
            gMap.setCenter(res[0].geometry.location); gMap.setZoom(10);
            if(gMark) gMark.setMap(null);
            gMark = new google.maps.Marker({map:gMap, position:res[0].geometry.location});
        }
    });
}
function updateMap(){
    const el = document.getElementById('map');
    if(!el || !st.map || !window.google) return;
    if(!gMap) gMap = new google.maps.Map(el, {center:{lat:33.38,lng:126.55}, zoom:10});
    
    if(st.tab==='overview' && window.inputs.dest) window.geoCode(window.inputs.dest);

    // ì¼ì • ë§ˆì»¤
    if(st.d && st.d.schedule){
        st.d.schedule.forEach((d,i)=>{
            const c=['red','blue','green','yellow'][i%4];
            d.events?.forEach(e=>{
                if(e.lat && e.lng) new google.maps.Marker({
                    position:{lat:e.lat,lng:e.lng}, map:gMap,
                    icon:`http://maps.google.com/mapfiles/ms/icons/${c}-dot.png`, title:e.title
                });
            });
        });
    }
}
function initAC(){
    const el = document.getElementById('ac-in');
    if(!st.map || !el) return;
    const ac = new google.maps.places.Autocomplete(el);
    ac.addListener('place_changed', ()=>{
        const p = ac.getPlace();
        if(p.geometry){
            window.inputs.evPl = p.name;
            window.inputs.evLat = p.geometry.location.lat();
            window.inputs.evLng = p.geometry.location.lng();
            el.value = p.name; // UI ì—…ë°ì´íŠ¸
        }
    });
}

// 5. Logic (No Render calls on input!)
// ì…ë ¥ í•¸ë“¤ëŸ¬: í™”ë©´ì„ ë‹¤ì‹œ ê·¸ë¦¬ì§€ ì•Šê³  ë³€ìˆ˜ê°’ë§Œ ë°”ê¿ˆ -> ëŠê¹€ í•´ê²°
window.hIn = (k, v) => { window.inputs[k] = v; }; 
// ë¸”ëŸ¬(í¬ì»¤ìŠ¤ í•´ì œ) ì‹œì—ë§Œ DB ì €ì¥ (Overview íƒ­)
window.hBlurOv = (k) => { if(st.d) saveDB({...st.d, [k]:window.inputs.dest}); if(k==='destination') window.geoCode(window.inputs.dest); };
window.hBlurDate = (k, v) => { window.inputs[k]=v; if(st.d) saveDB({...st.d, [k]:v}); };

// Actions (These DO call render via saveDB -> onSnapshot)
window.act = (type, p1) => {
    const d = st.d; if(!d) return;
    // ì¼ì •
    if(type==='addDay'){ d.schedule.push({id:Date.now(), day:d.schedule.length+1, date:'', events:[]}); st.dayIdx=d.schedule.length-1; }
    if(type==='delDay'){ d.schedule.splice(p1,1); d.schedule.forEach((x,i)=>x.day=i+1); st.dayIdx=Math.max(0,p1-1); }
    if(type==='uDayDate') d.schedule[st.dayIdx].date = p1;
    if(type==='addEv'){
        if(!window.inputs.evTit) return;
        d.schedule[st.dayIdx].events.push({id:Date.now(), time:window.inputs.evTime, title:window.inputs.evTit, place:window.inputs.evPl||'', lat:window.inputs.evLat, lng:window.inputs.evLng});
        d.schedule[st.dayIdx].events.sort((a,b)=>a.time.localeCompare(b.time));
        window.inputs.evTit=''; window.inputs.evPl=''; window.inputs.evLat=null; window.inputs.evLng=null;
        if(document.getElementById('ac-in')) document.getElementById('ac-in').value='';
    }
    if(type==='delEv') d.schedule[st.dayIdx].events.splice(p1,1);

    // ê¸°íƒ€ ëª©ë¡ë“¤
    if(type==='addPack'){ if(!window.inputs.pack)return; d.packingList.push({id:Date.now(), text:window.inputs.pack, checked:false}); window.inputs.pack=''; }
    if(type==='togPack') d.packingList.find(x=>x.id===p1).checked = !d.packingList.find(x=>x.id===p1).checked;
    if(type==='delPack') d.packingList = d.packingList.filter(x=>x.id!==p1);

    if(type==='addSouv'){ if(!window.inputs.sItem)return; d.souvenirs.push({id:Date.now(), item:window.inputs.sItem, receiver:window.inputs.sTo, bought:false}); window.inputs.sItem=''; window.inputs.sTo=''; }
    if(type==='togSouv') d.souvenirs.find(x=>x.id===p1).bought = !d.souvenirs.find(x=>x.id===p1).bought;
    if(type==='delSouv') d.souvenirs = d.souvenirs.filter(x=>x.id!==p1);

    if(type==='addExp'){ 
        const c = parseInt(window.inputs.exCost.replace(/,/g,'')); if(!window.inputs.exItem||isNaN(c))return;
        d.expenses.push({id:Date.now(), cat:window.inputs.exCat, item:window.inputs.exItem, cost:c, date:window.inputs.exDate});
        window.inputs.exItem=''; window.inputs.exCost='';
    }
    if(type==='delExp') d.expenses = d.expenses.filter(x=>x.id!==p1);

    saveDB(d); // This triggers snapshot -> render
};

// 6. Render
function render() {
    const t = document.getElementById('tabs');
    t.innerHTML = [['overview','ê°œìš”',I.Map],['schedule','ì¼ì •',I.Cal],['packing','ì¤€ë¹„',I.Check],['souvenir','ê¸°ë…',I.Gift],['expense','ì§€ì¶œ',I.Dol]]
      .map(([k,l,i])=>`<button onclick="st.tab='${k}';r()" class="flex-1 py-2 text-sm rounded ${st.tab===k?'bg-teal-100 text-teal-700 font-bold':'text-gray-500'} flex flex-col items-center gap-1">${svg(i)} ${l}</button>`).join('');

    const c = document.getElementById('view-content');
    const d = st.d || initD;

    let content = '';
    if(st.tab === 'overview'){
        const total = d.expenses.reduce((s,x)=>s+x.cost,0);
        content = `
         <div class="space-y-4 a-f">
           <div class="grid grid-cols-2 gap-4">
             <div class="col-span-1">
               <label class="text-xs text-gray-500">ì—¬í–‰ì§€</label>
               <!-- hInì€ ë Œë”ë§ ì•ˆí•¨. onblurì‹œ ì €ì¥ -->
               <input type="text" value="${window.inputs.dest}" oninput="hIn('dest',this.value)" onblur="hBlurOv('destination')" class="w-full border p-2 rounded outline-none ring-teal-500 focus:ring-2">
             </div>
             <div class="col-span-1 bg-red-50 p-2 rounded text-center">
               <div class="text-xs text-red-500">ì´ ì§€ì¶œ</div><div class="font-bold text-red-700">${total.toLocaleString()}ì›</div>
             </div>
             <input type="date" value="${window.inputs.sDate}" onchange="hBlurDate('startDate',this.value)" class="border p-2 rounded">
             <input type="date" value="${window.inputs.eDate}" onchange="hBlurDate('endDate',this.value)" class="border p-2 rounded">
           </div>
           <div id="map-container" class="w-full h-80 bg-gray-200 rounded overflow-hidden">
               <div id="map" class="w-full h-full"></div>
           </div>
         </div>`;
         setTimeout(updateMap, 50);
    } 
    else if(st.tab === 'schedule'){
        const day = d.schedule[st.dayIdx] || d.schedule[0];
        content = `
        <div class="space-y-4 a-f">
          <div class="flex gap-2 overflow-x-auto pb-1 no-scrollbar">
            ${d.schedule.map((x,i)=>`<button onclick="st.dayIdx=${i};r()" class="px-3 py-1 rounded border whitespace-nowrap ${st.dayIdx===i?'bg-teal-600 text-white':'bg-white'}">D${x.day} ${i>0?`<span onclick="event.stopPropagation();act('delDay',${i})" class="ml-1 opacity-50">x</span>`:''}</button>`).join('')}
            <button onclick="act('addDay')" class="px-3 border rounded bg-gray-100">+</button>
          </div>
          <div class="bg-white p-4 rounded shadow border">
            <div class="flex justify-between mb-3"><h3 class="font-bold text-teal-700">Day ${day.day}</h3><input type="date" value="${day.date}" onchange="act('uDayDate',this.value)" class="border rounded p-1 text-sm"></div>
            <div class="grid grid-cols-[auto_1fr_1fr_auto] gap-2 mb-4 items-center">
              <input type="time" value="${window.inputs.evTime}" onchange="hIn('evTime',this.value)" class="border p-1 rounded w-20">
              <input type="text" placeholder="ì¼ì •ëª…" value="${window.inputs.evTit}" oninput="hIn('evTit',this.value)" class="border p-1 rounded w-full">
              <input type="text" id="ac-in" placeholder="ì¥ì†Œê²€ìƒ‰" class="border p-1 rounded w-full">
              <button onclick="act('addEv')" class="bg-teal-600 text-white p-1 rounded w-8 h-8 flex items-center justify-center">${svg(I.Plus)}</button>
            </div>
            <div class="space-y-2 relative pl-4 border-l">
              ${day.events.map((e,i)=>`<div class="relative pl-4"><div class="absolute -left-[21px] top-1 w-3 h-3 bg-teal-500 rounded-full border-2 border-white"></div><div class="text-sm font-bold">${e.time} <span class="font-normal">${e.title}</span></div><div class="text-xs text-gray-500 flex justify-between">${e.place}<button onclick="act('delEv',${i})" class="text-red-300">x</button></div></div>`).join('')}
            </div>
          </div>
        </div>`;
        setTimeout(initAC, 50);
    }
    else if(st.tab === 'packing'){
        content = `<div class="space-y-4 a-f"><h3 class="font-bold border-b pb-1">ì¤€ë¹„ë¬¼</h3>
        <div class="flex gap-2"><input id="pk-in" placeholder="ì…ë ¥" value="${window.inputs.pack}" oninput="hIn('pack',this.value)" onkeypress="if(event.key==='Enter')act('addPack')" class="border p-2 rounded flex-1"><button onclick="act('addPack')" class="bg-teal-600 text-white px-4 rounded">ì¶”ê°€</button></div>
        <div class="grid grid-cols-2 gap-2">${d.packingList.map(x=>`<div onclick="act('togPack',${x.id})" class="p-2 border rounded flex justify-between items-center bg-white cursor-pointer ${x.checked?'opacity-50':''}"><span class="flex items-center gap-2">${x.checked?svg(I.Check,'teal'):'<div class="w-4 h-4 border rounded"></div>'} ${x.text}</span><button onclick="event.stopPropagation();act('delPack',${x.id})" class="text-gray-300 hover:text-red-500">x</button></div>`).join('')}</div></div>`;
        setTimeout(()=>document.getElementById('pk-in')?.focus(), 10);
    }
    else if(st.tab === 'souvenir'){
        content = `<div class="space-y-4 a-f"><h3 class="font-bold border-b pb-1">ê¸°ë…í’ˆ</h3>
        <div class="flex gap-2"><input id="sv-in" placeholder="ìƒí’ˆ" value="${window.inputs.sItem}" oninput="hIn('sItem',this.value)" class="border p-2 rounded flex-1"><input placeholder="ëŒ€ìƒ" value="${window.inputs.sTo}" oninput="hIn('sTo',this.value)" onkeypress="if(event.key==='Enter')act('addSouv')" class="border p-2 rounded w-24"><button onclick="act('addSouv')" class="bg-teal-600 text-white px-4 rounded">ì¶”ê°€</button></div>
        <div class="bg-white rounded border">${d.souvenirs.map(x=>`<div class="flex justify-between p-2 border-b last:border-0 items-center"><span class="flex gap-2 items-center"><input type="checkbox" ${x.bought?'checked':''} onchange="act('togSouv',${x.id})"> <span class="${x.bought?'line-through text-gray-400':''}">${x.item}</span> <span class="text-xs bg-gray-100 px-1 rounded">${x.receiver}</span></span><button onclick="act('delSouv',${x.id})" class="text-gray-300 hover:text-red-500">x</button></div>`).join('')}</div></div>`;
        setTimeout(()=>document.getElementById('sv-in')?.focus(), 10);
    }
    else if(st.tab === 'expense'){
        content = `<div class="space-y-4 a-f"><h3 class="font-bold border-b pb-1">ê°€ê³„ë¶€</h3>
        <div class="flex gap-2 flex-wrap"><input type="date" value="${window.inputs.exDate}" onchange="hIn('exDate',this.value)" class="border p-2 rounded text-sm w-28"><select onchange="hIn('exCat',this.value)" class="border p-2 rounded text-sm"><option>ì‹ë¹„</option><option>êµí†µ</option><option>ìˆ™ë°•</option><option>ì‡¼í•‘</option><option>ê¸°íƒ€</option></select><input id="ep-in" placeholder="ë‚´ì—­" value="${window.inputs.exItem}" oninput="hIn('exItem',this.value)" class="border p-2 rounded flex-1 min-w-[100px]"><input placeholder="ê¸ˆì•¡" value="${window.inputs.exCost}" oninput="hIn('exCost',this.value.replace(/[^0-9]/g,''))" onkeypress="if(event.key==='Enter')act('addExp')" class="border p-2 rounded w-24 text-right"><button onclick="act('addExp')" class="bg-teal-600 text-white px-4 rounded">ì¶”ê°€</button></div>
        <table class="w-full text-sm text-left"><thead class="bg-gray-100"><tr><th class="p-2">ë‚ ì§œ</th><th class="p-2">ë‚´ì—­</th><th class="p-2 text-right">ê¸ˆì•¡</th><th class="p-2 w-8"></th></tr></thead><tbody>${d.expenses.sort((a,b)=>new Date(b.date)-new Date(a.date)).map(x=>`<tr class="border-b"><td class="p-2 text-gray-500 text-xs">${x.date.slice(5)}</td><td class="p-2"><div><span class="text-xs bg-gray-100 px-1 rounded mr-1">${x.cat}</span>${x.item}</div></td><td class="p-2 text-right font-bold">${x.cost.toLocaleString()}</td><td class="p-2"><button onclick="act('delExp',${x.id})" class="text-gray-300 hover:text-red-500">x</button></td></tr>`).join('')}</tbody></table></div>`;
        setTimeout(()=>document.getElementById('ep-in')?.focus(), 10);
    }
    c.innerHTML = content;
    document.getElementById('icon-map-h').innerHTML = svg(I.Pin,'white');
}
window.r = render;
</script>
</body>
</html>
