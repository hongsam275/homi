<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ì—¬í–‰ í”Œë˜ë„ˆ</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ì ìš© -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* ì¼ì •í‘œ íƒ­ ê°€ë¡œ ìŠ¤í¬ë¡¤ ì‹œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
    
    <!-- React ë° Babel ë¡œë“œ (JSXë¥¼ ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰í•˜ê¸° ìœ„í•¨) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDK ë¡œë“œ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì—¬ React ì»´í¬ë„ŒíŠ¸ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•¨
        window.firebaseApp = initializeApp(JSON.parse(window.__firebase_config));
        window.db = getFirestore(window.firebaseApp);
        window.auth = getAuth(window.firebaseApp);

        // React ì»´í¬ë„ŒíŠ¸ê°€ ì´ ì „ì—­ ë³€ìˆ˜ë“¤ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì´ˆê¸° ì¸ì¦ ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
        // React ì½”ë“œ ë¸”ë¡ ë‚´ì—ì„œ ì´ ë³€ìˆ˜ë“¤ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    </script>
</head>
<body>
    <div id="root"></div>

    <!-- Lucide-React ì•„ì´ì½˜ë“¤ì„ ì¸ë¼ì¸ SVGë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í—¬í¼ -->
    <script>
        const ICONS = {
            Map: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"></polygon><line x1="9" x2="9" y1="3" y2="18"></line><line x1="15" x2="15" y1="6" y2="21"></line></svg>',
            Calendar: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg>',
            CheckSquare: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>',
            Gift: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="8" width="18" height="4" rx="1"></rect><path d="M12 22v-6H8a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4v6"></path><path d="M12 22v-6H8a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4v6"></path><path d="M12 22v-6H8a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4v6"></path><path d="M10 8V5a2 2 0 1 1 4 0v3"></path></svg>',
            DollarSign: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>',
            Plus: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"></path><path d="M5 12h14"></path></svg>',
            Trash2: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M15 6V4c0-1-1-2-2-2h-2c-1 0-2 1-2 2v2"></path></svg>',
            MapPin: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg>',
            RotateCcw: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9 9h9"></path><path d="M18 13v6h6"></path></svg>',
            Search: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>',
        };
        // Reactì—ì„œ ì•„ì´ì½˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í—¬í¼ í•¨ìˆ˜ ì •ì˜
        const IconComponent = ({ name, size, className = "" }) => {
            const svgMarkup = ICONS[name] ? ICONS[name].replace(/width="16" height="16"/g, `width="${size}" height="${size}"`) : '';
            return <span className={className} dangerouslySetInnerHTML={{ __html: svgMarkup }}></span>;
        };
        // Lucide-react ì•„ì´ì½˜ì„ ì§ì ‘ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, React.createElement ë˜í¼ë¥¼ ì •ì˜
        const Map = (props) => React.createElement(IconComponent, { name: 'Map', ...props });
        const Calendar = (props) => React.createElement(IconComponent, { name: 'Calendar', ...props });
        const CheckSquare = (props) => React.createElement(IconComponent, { name: 'CheckSquare', ...props });
        const Gift = (props) => React.createElement(IconComponent, { name: 'Gift', ...props });
        const DollarSign = (props) => React.createElement(IconComponent, { name: 'DollarSign', ...props });
        const Plus = (props) => React.createElement(IconComponent, { name: 'Plus', ...props });
        const Trash2 = (props) => React.createElement(IconComponent, { name: 'Trash2', ...props });
        const MapPin = (props) => React.createElement(IconComponent, { name: 'MapPin', ...props });
        const RotateCcw = (props) => React.createElement(IconComponent, { name: 'RotateCcw', ...props });
        const Search = (props) => React.createElement(IconComponent, { name: 'Search', ...props });
    </script>

    <!-- React Component Code (with Babel transpilation) -->
    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = window;
        const { getFirestore, doc, setDoc, onSnapshot } = window;
        
        // --- Configuration ---
        // [ì¤‘ìš”] ì—¬ê¸°ì— ë³¸ì¸ì˜ Google Maps API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš” (Places API í™œì„±í™” í•„ìˆ˜)
        const GOOGLE_MAPS_API_KEY = ''; 

        // Firebase Context variables are provided via window object
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Firebase Instances
        const db = window.db;
        const auth = window.auth;


        // --- Helper Components ---
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-lg p-6 ${className}`}>{children}</div>
        );

        // --- Google Maps Script Loader ---
        const loadGoogleMapsScript = (callback) => {
            if (window.google && window.google.maps) {
                callback();
                return;
            }
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places`;
            script.async = true;
            script.defer = true;
            script.onload = callback;
            document.head.appendChild(script);
        };

        function App() {
          // App State
          const [activeTab, setActiveTab] = useState('overview');
          const [data, setData] = useState(null);
          const [userId, setUserId] = useState(null);
          const [isAuthReady, setIsAuthReady] = useState(false);
          const [showModal, setShowModal] = useState(false);
          
          // Schedule View State
          const [selectedDayIndex, setSelectedDayIndex] = useState(0); // For horizontal tabs

          // Maps State
          const mapRef = useRef(null);
          const mapInstanceRef = useRef(null);
          const markersRef = useRef([]);
          const autocompleteInputRef = useRef(null);
          const autocompleteInstanceRef = useRef(null);
          const [isMapLoaded, setIsMapLoaded] = useState(false);

          // Inputs State
          const [inputs, setInputs] = useState({
            packingItem: '',
            souvenirItem: '',
            souvenirReceiver: '',
            expenseCategory: 'ì‹ë¹„',
            expenseItem: '',
            expenseCost: '',
            expenseDate: new Date().toISOString().split('T')[0],
            
            // Schedule Event Inputs
            eventTime: '09:00',
            eventTitle: '',
            eventPlaceName: '',
            eventLat: null,
            eventLng: null
          });

          // Initial Data
          const initialData = {
            destination: 'ì œì£¼ë„',
            startDate: '',
            endDate: '',
            packingList: [],
            // schedule structure change: array of Day objects
            schedule: [
                { id: Date.now(), day: 1, date: '', events: [] } 
            ],
            souvenirs: [],
            expenses: [] 
          };

          // --- Firebase Logic ---
          const updateFirestore = useCallback(async (newData) => {
            if (!db || !userId) return;
            const planDocRef = doc(db, 'artifacts', appId, 'users', userId, 'travelPlans', 'myPlanV3');
            try {
              await setDoc(planDocRef, newData); 
            } catch (e) {
              console.error("Error updating document:", e);
            }
          }, [userId]);

          useEffect(() => {
            if (!auth) return;
            const unsubscribeAuth = onAuthStateChanged(auth, (user) => {
                if (user) setUserId(user.uid);
                else {
                    if (!initialAuthToken) signInAnonymously(auth).catch(console.error);
                }
                setIsAuthReady(true);
            });

            const authenticate = async () => {
                try {
                    if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken);
                    else await signInAnonymously(auth);
                } catch (error) {
                    console.error("Auth Error:", error);
                }
            };
            authenticate();
            return () => unsubscribeAuth();
          }, []);

          useEffect(() => {
            if (!db || !userId || !isAuthReady) {
                if (isAuthReady && !data) setData(initialData); 
                return;
            }
            const planDocRef = doc(db, 'artifacts', appId, 'users', userId, 'travelPlans', 'myPlanV3');
            const unsubscribeSnapshot = onSnapshot(planDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    setData(docSnap.data());
                } else {
                    setData(initialData);
                    updateFirestore(initialData);
                }
            });
            return () => unsubscribeSnapshot();
          }, [db, userId, isAuthReady, updateFirestore]);


          // --- Maps & Places Logic ---
          
          useEffect(() => {
              // Load map script once
              if (!isMapLoaded && GOOGLE_MAPS_API_KEY) {
                  loadGoogleMapsScript(() => setIsMapLoaded(true));
              }
          }, []);

          // Initialize Autocomplete when input is available
          useEffect(() => {
              if (isMapLoaded && activeTab === 'schedule' && autocompleteInputRef.current && window.google) {
                  autocompleteInstanceRef.current = new window.google.maps.places.Autocomplete(autocompleteInputRef.current);
                  autocompleteInstanceRef.current.addListener("place_changed", () => {
                      const place = autocompleteInstanceRef.current.getPlace();
                      if (place.geometry) {
                          setInputs(prev => ({
                              ...prev,
                              eventPlaceName: place.name,
                              eventLat: place.geometry.location.lat(),
                              eventLng: place.geometry.location.lng()
                          }));
                      }
                  });
              }
          }, [isMapLoaded, activeTab, selectedDayIndex]); 

          // Initialize Overview Map
          useEffect(() => {
              if (isMapLoaded && activeTab === 'overview' && mapRef.current && data && window.google) {
                  if (!mapInstanceRef.current) {
                      mapInstanceRef.current = new window.google.maps.Map(mapRef.current, {
                          center: { lat: 33.3846, lng: 126.5535 }, // Default Center
                          zoom: 10,
                      });
                  }
                  updateMapMarkers();
              }
          }, [isMapLoaded, activeTab, data]);

          const updateMapMarkers = () => {
              if (!mapInstanceRef.current || !data?.schedule || !window.google) return;

              // Clear markers
              markersRef.current.forEach(m => m.setMap(null));
              markersRef.current = [];

              const bounds = new window.google.maps.LatLngBounds();
              let hasMarkers = false;

              // Pin Colors per Day
              const colors = ['red', 'blue', 'green', 'orange', 'purple', 'yellow'];

              data.schedule.forEach((day, idx) => {
                  if(day.events) {
                      day.events.forEach(event => {
                          if (event.lat && event.lng) {
                              const color = colors[idx % colors.length];
                              const iconUrl = `http://maps.google.com/mapfiles/ms/icons/${color}-dot.png`;
                              
                              const marker = new window.google.maps.Marker({
                                  position: { lat: event.lat, lng: event.lng },
                                  map: mapInstanceRef.current,
                                  title: event.title,
                                  icon: iconUrl
                              });
                              
                              const infoWindow = new window.google.maps.InfoWindow({
                                content: `<div style="color:black"><b>Day ${day.day}</b><br/>${event.title}<br/>${event.time}</div>`
                              });
                              
                              marker.addListener("click", () => infoWindow.open(mapInstanceRef.current, marker));

                              markersRef.current.push(marker);
                              bounds.extend(marker.getPosition());
                              hasMarkers = true;
                          }
                      });
                  }
              });

              if (hasMarkers) {
                  mapInstanceRef.current.fitBounds(bounds);
              }
          };


          // --- Actions ---

          const handleInput = (key, value) => {
              setInputs(prev => ({ ...prev, [key]: value }));
          };

          // Schedule Actions
          const addDay = () => {
              const newDayNum = data.schedule.length + 1;
              const newSchedule = [...data.schedule, { id: Date.now(), day: newDayNum, date: '', events: [] }];
              updateFirestore({ ...data, schedule: newSchedule });
              setSelectedDayIndex(newSchedule.length - 1); // Switch to new day
          };

          const deleteDay = (e, index) => {
              e.stopPropagation();
              if (data.schedule.length <= 1) return; // Keep at least one day
              const newSchedule = data.schedule.filter((_, i) => i !== index).map((d, i) => ({ ...d, day: i + 1 }));
              updateFirestore({ ...data, schedule: newSchedule });
              setSelectedDayIndex(Math.max(0, index - 1));
          };

          const updateDayDate = (date) => {
              const newSchedule = [...data.schedule];
              newSchedule[selectedDayIndex].date = date;
              updateFirestore({ ...data, schedule: newSchedule });
          };

          const addEventToDay = () => {
              if (!inputs.eventTitle) return;
              
              const newEvent = {
                  id: Date.now(),
                  time: inputs.eventTime,
                  title: inputs.eventTitle,
                  placeName: inputs.eventPlaceName,
                  lat: inputs.eventLat,
                  lng: inputs.eventLng
              };

              const newSchedule = [...data.schedule];
              // Initialize events array if missing (compatibility)
              if (!newSchedule[selectedDayIndex].events) newSchedule[selectedDayIndex].events = [];
              
              newSchedule[selectedDayIndex].events.push(newEvent);
              // Sort by time
              newSchedule[selectedDayIndex].events.sort((a, b) => a.time.localeCompare(b.time));

              updateFirestore({ ...data, schedule: newSchedule });
              setInputs(prev => ({ ...prev, eventTitle: '', eventPlaceName: '', eventLat: null, eventLng: null }));
              if (autocompleteInputRef.current) autocompleteInputRef.current.value = '';
          };

          const deleteEvent = (eventIndex) => {
              const newSchedule = [...data.schedule];
              newSchedule[selectedDayIndex].events.splice(eventIndex, 1);
              updateFirestore({ ...data, schedule: newSchedule });
          };

          // Other Actions
          const addExpense = () => {
              const cost = parseInt(inputs.expenseCost.replace(/,/g, ''));
              if (!inputs.expenseItem || isNaN(cost)) return;
              const newExpenses = [...data.expenses, { id: Date.now(), category: inputs.expenseCategory, item: inputs.expenseItem, cost, date: inputs.expenseDate }];
              updateFirestore({ ...data, expenses: newExpenses });
              setInputs(prev => ({ ...prev, expenseItem: '', expenseCost: '' }));
          };

          const deleteExpense = (id) => {
              const newExpenses = data.expenses.filter(e => e.id !== id);
              updateFirestore({ ...data, expenses: newExpenses });
          };

          const addPacking = () => {
            if (!inputs.packingItem) return;
            updateFirestore({ ...data, packingList: [...data.packingList, { id: Date.now(), text: inputs.packingItem, checked: false }]});
            setInputs(prev => ({ ...prev, packingItem: '' }));
          };

          const addSouvenir = () => {
            if (!inputs.souvenirItem) return;
            updateFirestore({ ...data, souvenirs: [...data.souvenirs, { id: Date.now(), item: inputs.souvenirItem, receiver: inputs.souvenirReceiver, bought: false }]});
            setInputs(prev => ({ ...prev, souvenirItem: '', souvenirReceiver: '' }));
          };

          const toggleCheck = (list, id, field='checked') => {
              const updated = data[list].map(i => i.id === id ? { ...i, [field]: !i[field] } : i);
              updateFirestore({ ...data, [list]: updated });
          };
          
          const deleteItem = (list, id) => {
              const updated = data[list].filter(i => i.id !== id);
              updateFirestore({ ...data, [list]: updated });
          };

          const totalExpense = data?.expenses?.reduce((sum, item) => sum + Number(item.cost), 0) || 0;


          if (!isAuthReady || !data) return <div className="flex h-screen items-center justify-center text-teal-600 font-bold animate-pulse">Loading Planner...</div>;

          return (
            <div className="min-h-screen bg-gray-50 font-sans text-gray-800 pb-20">
              {/* Header */}
              <header className="bg-teal-600 text-white p-4 shadow-md sticky top-0 z-20">
                <div className="max-w-4xl mx-auto flex justify-between items-center">
                  <h1 className="text-xl font-bold flex items-center gap-2">
                    <MapPin size={24} /> ë‚˜ë§Œì˜ ì—¬í–‰ í”Œë˜ë„ˆ
                  </h1>
                  <div className="flex items-center gap-3">
                     <button onClick={() => setShowModal(true)} className="text-xs bg-teal-700 hover:bg-teal-800 px-3 py-1 rounded flex items-center gap-1 transition">
                        <RotateCcw size={12}/> ì´ˆê¸°í™”
                     </button>
                  </div>
                </div>
              </header>

              <div className="max-w-4xl mx-auto p-4">
                {/* Navigation Tabs - ìˆ˜ì •ëœ ë¶€ë¶„ */}
                <div className="flex gap-1 mb-6 bg-white p-2 rounded-lg shadow-sm overflow-x-auto justify-between">
                  {[
                    { id: 'overview', label: 'ì—¬í–‰ ê°œìš”', icon: Map },
                    { id: 'schedule', label: 'ì¼ì •í‘œ', icon: Calendar },
                    { id: 'packing', label: 'ì¤€ë¹„ë¬¼', icon: CheckSquare },
                    { id: 'souvenir', label: 'ê¸°ë…í’ˆ', icon: Gift },
                    { id: 'expense', label: 'ê°€ê³„ë¶€', icon: DollarSign },
                  ].map(tab => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`flex-1 min-w-[50px] py-1 px-2 rounded-md flex flex-col items-center justify-center text-xs gap-0.5 transition-all
                        ${activeTab === tab.id ? 'bg-teal-100 text-teal-700 font-bold shadow-inner' : 'text-gray-500 hover:bg-gray-100'}`}
                    >
                      {/* ì•„ì´ì½˜ í¬ê¸° ì¶•ì†Œ */}
                      {React.createElement(tab.icon, { size: 16 })} {tab.label}
                    </button>
                  ))}
                </div>

                {/* --- 1. ì—¬í–‰ ê°œìš” (Overview) --- */}
                {activeTab === 'overview' && (
                   <div className="space-y-6 animate-fade-in">
                      <h2 className="text-2xl font-bold text-gray-800 border-b pb-2">âœˆï¸ ì—¬í–‰ ê¸°ë³¸ ì •ë³´</h2>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">ì—¬í–‰ì§€</label>
                            <input type="text" value={data.destination} onChange={(e) => updateFirestore({...data, destination: e.target.value})} className="w-full border rounded-lg p-3 outline-none focus:ring-2 focus:ring-teal-500"/>
                         </div>
                         {/* Total Expense Display (Linked to Expense Tab) */}
                         <div className="bg-red-50 border border-red-100 rounded-lg p-3 flex flex-col justify-center">
                            <label className="text-sm font-medium text-red-500">ì´ ì§€ì¶œ (ê°€ê³„ë¶€ ì—°ë™)</label>
                            <div className="text-2xl font-bold text-red-700">{totalExpense.toLocaleString()}ì›</div>
                         </div>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                         <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">ì‹œì‘ì¼</label>
                            <input type="date" value={data.startDate} onChange={(e) => updateFirestore({...data, startDate: e.target.value})} className="w-full border rounded-lg p-2"/>
                         </div>
                         <div>
                            <label className="block text-sm font-medium text-gray-600 mb-1">ì¢…ë£Œì¼</label>
                            <input type="date" value={data.endDate} onChange={(e) => updateFirestore({...data, endDate: e.target.value})} className="w-full border rounded-lg p-2"/>
                         </div>
                      </div>

                      {/* Google Map Overview */}
                      <div className="mt-6">
                         <label className="block text-sm font-medium text-gray-600 mb-2">ğŸ“ ì—¬í–‰ ì§€ë„ (ì¼ì •í‘œ í•€ í‘œì‹œ)</label>
                         <div className="w-full h-96 bg-gray-200 rounded-lg overflow-hidden border relative">
                            <div ref={mapRef} className="w-full h-full"></div>
                            {!isMapLoaded && <div className="absolute inset-0 flex items-center justify-center text-gray-500">ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘... (API í‚¤ í™•ì¸ í•„ìš”)</div>}
                         </div>
                      </div>
                   </div>
                )}

                {/* --- 2. ì¼ì •í‘œ (Schedule) --- */}
                {activeTab === 'schedule' && (
                   <div className="space-y-4 animate-fade-in">
                      <h2 className="text-2xl font-bold text-gray-800">ğŸ“… ìƒì„¸ ì¼ì •</h2>
                      
                      {/* Horizontal Day Tabs */}
                      <div className="flex items-center gap-2 overflow-x-auto pb-2 no-scrollbar">
                         {data.schedule.map((day, idx) => (
                            <button 
                                key={day.id} 
                                onClick={() => setSelectedDayIndex(idx)}
                                className={`flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold transition whitespace-nowrap border
                                ${selectedDayIndex === idx ? 'bg-teal-600 text-white border-teal-600 shadow-md' : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}`}
                            >
                                Day {day.day}
                                {idx > 0 && (
                                    <span 
                                        onClick={(e) => deleteDay(e, idx)}
                                        className="ml-2 opacity-60 hover:opacity-100 hover:text-red-300"
                                    >Ã—</span>
                                )}
                            </button>
                         ))}
                         <button onClick={addDay} className="flex-shrink-0 px-3 py-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 border border-gray-300">
                            <Plus size={16}/>
                         </button>
                      </div>

                      {/* Selected Day Content */}
                      <Card className="min-h-[400px]">
                         <div className="flex justify-between items-center border-b pb-3 mb-4">
                            <h3 className="text-lg font-bold text-teal-700">Day {data.schedule[selectedDayIndex].day}</h3>
                            <input 
                                type="date" 
                                value={data.schedule[selectedDayIndex].date} 
                                onChange={(e) => updateDayDate(e.target.value)}
                                className="border rounded px-2 py-1 text-sm text-gray-600"
                            />
                         </div>

                         {/* Add Event Form */}
                         <div className="bg-gray-50 p-3 rounded-lg border border-gray-200 mb-6 grid grid-cols-1 md:grid-cols-[100px_1fr_1fr_auto] gap-2 items-center">
                            <input 
                                type="time" 
                                value={inputs.eventTime} 
                                onChange={(e) => handleInput('eventTime', e.target.value)}
                                className="border rounded p-2 text-sm w-full"
                            />
                            <input 
                                type="text" 
                                placeholder="ì¼ì • ì œëª© (ì˜ˆ: ì ì‹¬ ì‹ì‚¬)" 
                                value={inputs.eventTitle} 
                                onChange={(e) => handleInput('eventTitle', e.target.value)}
                                className="border rounded p-2 text-sm w-full"
                            />
                            <div className="relative w-full">
                                <input 
                                    ref={autocompleteInputRef}
                                    type="text" 
                                    placeholder="ì¥ì†Œ ê²€ìƒ‰ (êµ¬ê¸€ë§µ)" 
                                    className="border rounded p-2 text-sm w-full pr-8"
                                />
                                <Search size={14} className="absolute right-3 top-3 text-gray-400"/>
                            </div>
                            <button onClick={addEventToDay} className="bg-teal-600 text-white p-2 rounded hover:bg-teal-700 w-full md:w-auto">
                                <Plus size={20} className="mx-auto"/>
                            </button>
                         </div>

                         {/* Events List */}
                         <div className="space-y-3 relative">
                            <div className="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>
                            {data.schedule[selectedDayIndex].events && data.schedule[selectedDayIndex].events.length > 0 ? (
                                data.schedule[selectedDayIndex].events.map((event, eIdx) => (
                                    <div key={event.id} className="relative pl-10 group">
                                        <div className="absolute left-[11px] top-4 w-3 h-3 bg-teal-500 rounded-full border-2 border-white shadow-sm z-10"></div>
                                        <div className="bg-white border border-gray-100 rounded-lg p-3 shadow-sm hover:shadow-md transition flex justify-between items-start">
                                            <div>
                                                <div className="flex items-center gap-2">
                                                    <span className="font-bold text-gray-800 text-lg">{event.time}</span>
                                                    <span className="text-gray-900 font-medium">{event.title}</span>
                                                </div>
                                                {event.placeName && (
                                                    <div className="text-xs text-gray-500 mt-1 flex items-center gap-1">
                                                        <MapPin size={12}/> {event.placeName}
                                                    </div>
                                                )}
                                            </div>
                                            <button onClick={() => deleteEvent(eIdx)} className="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                                                <Trash2 size={16}/>
                                            </button>
                                        </div>
                                    </div>
                                ))
                            ) : (
                                <div className="text-center text-gray-400 py-10 pl-4">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                            )}
                         </div>
                      </Card>
                   </div>
                )}

                {/* --- 3. ì¤€ë¹„ë¬¼ (Packing) --- */}
                {activeTab === 'packing' && (
                    <div className="space-y-6">
                        <h2 className="text-2xl font-bold text-gray-800 border-b pb-2">ğŸ’ ì¤€ë¹„ë¬¼ ë¦¬ìŠ¤íŠ¸</h2>
                        <div className="flex gap-2">
                            <input type="text" value={inputs.packingItem} onChange={(e) => handleInput('packingItem', e.target.value)} onKeyPress={(e) => e.key === 'Enter' && addPacking()} placeholder="ì¤€ë¹„ë¬¼ ì…ë ¥..." className="flex-1 border rounded-lg p-2"/>
                            <button onClick={addPacking} className="bg-teal-600 text-white px-4 rounded-lg hover:bg-teal-700">ì¶”ê°€</button>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-4">
                            {data.packingList.map(item => (
                                <div key={item.id} onClick={() => toggleCheck('packingList', item.id)} className={`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all ${item.checked ? 'bg-gray-100 border-gray-200' : 'bg-white border-teal-100 shadow-sm hover:shadow'}`}>
                                    <div className="flex items-center gap-3 overflow-hidden">
                                        <CheckSquare size={18} className={item.checked ? "text-teal-600" : "text-gray-300"}/> 
                                        <span className={`truncate ${item.checked ? 'text-gray-400 line-through' : 'text-gray-800'}`}>{item.text}</span>
                                    </div>
                                    <button onClick={(e) => { e.stopPropagation(); deleteItem('packingList', item.id); }} className="text-gray-300 hover:text-red-500"><Trash2 size={16}/></button>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {/* --- 4. ê¸°ë…í’ˆ (Souvenir) --- */}
                {activeTab === 'souvenir' && (
                    <div className="space-y-6">
                        <h2 className="text-2xl font-bold text-gray-800 border-b pb-2">ğŸ ê¸°ë…í’ˆ ëª©ë¡</h2>
                        <div className="flex gap-2 mb-4 p-4 bg-gray-50 rounded-lg">
                            <input type="text" value={inputs.souvenirItem} onChange={(e) => handleInput('souvenirItem', e.target.value)} placeholder="ìƒí’ˆëª…" className="flex-[2] border rounded p-2 text-sm"/>
                            <input type="text" value={inputs.souvenirReceiver} onChange={(e) => handleInput('souvenirReceiver', e.target.value)} onKeyPress={(e) => e.key === 'Enter' && addSouvenir()} placeholder="ë°›ëŠ” ì‚¬ëŒ" className="flex-1 border rounded p-2 text-sm"/>
                            <button onClick={addSouvenir} className="bg-teal-600 text-white px-4 rounded hover:bg-teal-700 text-sm">ì¶”ê°€</button>
                        </div>
                        <div className="overflow-x-auto">
                            <table className="w-full text-left border-collapse">
                                <thead className="bg-teal-50 text-teal-800">
                                    <tr>
                                        <th className="p-3 w-16 text-center">êµ¬ë§¤</th>
                                        <th className="p-3">ìƒí’ˆëª…</th>
                                        <th className="p-3">ë°›ëŠ” ì‚¬ëŒ</th>
                                        <th className="p-3 w-16 text-center">ì‚­ì œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {data.souvenirs.map(s => (
                                        <tr key={s.id} className="border-b hover:bg-gray-50">
                                            <td className="p-3 text-center"><input type="checkbox" checked={s.bought} onChange={() => toggleCheck('souvenirs', s.id, 'bought')} className="w-4 h-4 text-teal-600"/></td>
                                            <td className={`p-3 ${s.bought ? 'line-through text-gray-400' : ''}`}>{s.item}</td>
                                            <td className="p-3 text-gray-600 font-medium">{s.receiver}</td>
                                            <td className="p-3 text-center"><button onClick={() => deleteItem('souvenirs', s.id)} className="text-gray-300 hover:text-red-500"><Trash2 size={16}/></button></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                )}

                {/* --- 5. ê°€ê³„ë¶€ (Expense) --- */}
                {activeTab === 'expense' && (
                    <div className="space-y-6">
                        <h2 className="text-2xl font-bold text-gray-800 border-b pb-2">ğŸ’¸ ì—¬í–‰ ê°€ê³„ë¶€</h2>
                        
                        {/* Total Only */}
                        <div className="bg-red-50 p-6 rounded-lg border border-red-100 text-center">
                            <p className="text-sm text-red-500 mb-1">í˜„ì¬ê¹Œì§€ ì´ ì§€ì¶œ</p>
                            <p className="text-3xl font-bold text-red-700">{totalExpense.toLocaleString()}ì›</p>
                        </div>

                        <div className="flex gap-2 mb-4 flex-wrap">
                            <input type="date" value={inputs.expenseDate} onChange={(e) => handleInput('expenseDate', e.target.value)} className="border rounded p-2 text-sm"/>
                            <select value={inputs.expenseCategory} onChange={(e) => handleInput('expenseCategory', e.target.value)} className="border rounded p-2 text-sm">
                                <option>ì‹ë¹„</option><option>êµí†µ</option><option>ìˆ™ë°•</option><option>ì‡¼í•‘</option><option>ê¸°íƒ€</option>
                            </select>
                            <input type="text" value={inputs.expenseItem} onChange={(e) => handleInput('expenseItem', e.target.value)} placeholder="ë‚´ìš©" className="flex-1 border rounded p-2 text-sm min-w-[120px]"/>
                            <input type="text" inputMode="numeric" value={inputs.expenseCost} onChange={(e) => handleInput('expenseCost', e.target.value.replace(/[^0-9]/g, ''))} onKeyPress={(e) => e.key === 'Enter' && addExpense()} placeholder="ê¸ˆì•¡" className="w-24 border rounded p-2 text-sm text-right"/>
                            <button onClick={addExpense} className="bg-teal-600 text-white px-4 rounded hover:bg-teal-700 text-sm">ì¶”ê°€</button>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full text-left border-collapse text-sm">
                                <thead className="bg-gray-100 sticky top-0">
                                    <tr>
                                        <th className="p-3 w-24">ë‚ ì§œ</th>
                                        <th className="p-3 w-20">ë¶„ë¥˜</th>
                                        <th className="p-3">ë‚´ì—­</th>
                                        <th className="p-3 text-right">ê¸ˆì•¡</th>
                                        <th className="p-3 w-12 text-center">ì‚­ì œ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {data.expenses.sort((a,b) => new Date(b.date) - new Date(a.date)).map(e => (
                                        <tr key={e.id} className="border-b hover:bg-gray-50">
                                            <td className="p-3 text-gray-500 text-xs">{e.date}</td>
                                            <td className="p-3"><span className="bg-gray-200 text-gray-600 text-xs px-2 py-1 rounded">{e.category}</span></td>
                                            <td className="p-3">{e.item}</td>
                                            <td className="p-3 text-right font-bold text-gray-700">{e.cost.toLocaleString()}ì›</td>
                                            <td className="p-3 text-center"><button onClick={() => deleteExpense(e.id)} className="text-gray-300 hover:text-red-500"><Trash2 size={14}/></button></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                )}

              </div>

              {/* Confirmation Modal */}
              {showModal && (
                <div className="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                        <h3 className="text-xl font-bold text-gray-800 mb-4">âš ï¸ ë°ì´í„° ì´ˆê¸°í™”</h3>
                        <p className="text-gray-600 mb-6">ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                        <div className="flex justify-end gap-3">
                            <button onClick={() => setShowModal(false)} className="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">ì·¨ì†Œ</button>
                            <button onClick={() => { updateFirestore(initialData); setShowModal(false); }} className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">í™•ì¸</button>
                        </div>
                    </div>
                </div>
              )}
            </div>
          );
        }
        
        // Root ë Œë”ë§
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>

